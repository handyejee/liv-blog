---
title: '스프링 프레임워크 첫걸음 - 4장 : 데이터베이스 작업'
date: '2024-07-14'
tags: ['java', 'spring', 'postgreSQL']
draft: false
summary: 'JDBC를 사용해 스프링에서 데이터베이스를 조작하는 방법을 알아보자'
---

일반적으로 데이터베이스를 사용할때는 터미널을 통해 데이터베이스에 직접 접속하거나, DB 툴(dbeaver, mysqlWorkbench)을 사용하는 방법을 사용합니다. 스프링에서 데이터베이스를 사용할때는 매퍼를 사용해 데이터베이스에 접속합니다. 4장에서는 데이터베이스(postgreSQL)에 직접 접속해 데이터베이스를 사용해보고, 스프링 JDBC를 통해서 데이터베이스를 사용하는 방법에 대해 알아보겠습니다.

## 1. 데이터베이스 생성

PostgreSQL을 사용해서 데이터베이스를 접속해보겠습니다. 먼저 PostgreSQL이 설치되어 있어야 하는데, MacOS를 사용하고 있는 경우 homebrew를 통해 간단히 설치할 수 있습니다. [postgreSQL 홈페이지](https://www.postgresql.org/download/macosx/) 에서 최신버전을 확인 할 수 있습니다. 저는 15버전을 다운로드 하였습니다.

```bash
brew install postgresql@15
```

설치 후, 아래와 같이 환경 설정을 해줍니다.

```bash
echo 'export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
export LDFLAGS="-L/opt/homebrew/opt/postgresql@15/lib"
export CPPFLAGS="-I/opt/homebrew/opt/postgresql@15/include"
```

환경설정까지 완료되었다면, postgreSQL에 접속하는 명령어를 터미널에 입력해줍니다. 데이터베이스에 접속했다면, psql postgres 명령어를 입력합니다. 여기까지 에러메세지 없이 입력 되었다면 접속에 성공한 거라고 볼 수 있습니다. 데이터베이스에 접속한 후, \du 명령어를 입력하면 할당된 사용자를 확인할 수 있습니다. 이때 확인한 사용자는 DB툴을 연동할때 사용할 수 있습니다.

```bash
brew services start postgresql@15
psql postgres
```

```bash
postgres=# \du
```

터미널을 통해서 데이터베이스에 접속해 사용할 수도 있지만, postgreSQL은 pgAdmin4라는 데이터베이스 뷰어를 제공합니다. 데이터베이스 툴을 사용하면 더 쉽게 테이블과 각 컬럼의 구조를 확인하고 수정할 수 있습니다.

pgdmin4를 사용하기 위해서는 [pgAdmin 다운로드 사이트](https://www.pgadmin.org/download/)에서 각 OS에 맞는 버전을 다운로드 합니다. 다운로드 한 후 Server - Register - Server 경로를 통해 등록 할 수 있습니다. Genral 탭에서 서버 이름, Connection 탭에서 Hostname은 localhost, 이전 \du 명령어를 통해 확인했던 Username, 사용하고자 하는 Password를 입력해줍니다. 테이블을 저장하면, postgreSQL에서 자동으로 생성한 테이블인 postgre 이름의 데이터베이스를 확인할 수 있습니다.

<img width="460" height="300" src="/static/images/springstudy/postgresql.png"/>


## 2. 데이터베이스 생성과 입력
pgAdmin4에 postgreSQL이 올바르게 연결되었다면 pgAdmin4를 통해 테이블을 생성하고, 조회하고, 수정하고, 삭제하는 기능을 수행해 보겠습니다.

먼저 회원 정보를 저장하는 member 테이블을 생성해보겠습니다. 데이터베이스 이름 - Schemas - Tables 경로로 접근해 Create - Table 을 실행합니다.
member 테이블에 id와 name 두개의 컬럼을 생성해주겠습니다.

<img width="460" height="300" src="/static/images/springstudy/createtable.png"/>
<img width="460" height="300" src="/static/images/springstudy/create.png"/>

생성한 테이블에서 오른쪽 마우스를 클릭하면 Query Tool 화면이 노출되는데 Query Tool에서 쿼리문을 수행할 수 있습니다.


## 3. 스프링 데이터 JDBC 사용해보기
애플리케이션에서 사용하는 객체와 관계형 데이터베이스의 데이터를 매핑하는 것을 O/R(Object-relational Mapper)라고 부릅니다. 사용자가 직접 데이터베이스에 접속하거나, SQL문을 직접 주입하지 않고 매퍼를 통해 데이터를 매핑하는 것을 의미합니다.

스프링에서 member 테이블에 JDBC를 사용해서 데이터 삽입과 조회를 수행하는 프로그램을 만들어보겠습니다. Spring 프로젝트를 생성합니다. 데이터베이스를 사용하기 위해서는 데이터베이스 접속 정보가 필요합니다. 이때 입력해야 하는 정보는 사용하고자 하는 데이터베이스의 드라이버의 클래스명, 데이터베이스의 접속 URL, 그리고 사용자 이름과 비밀번호 입니다. 

```
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=jdbc:postgresql://localhost:5432/postgres
spring.datasource.username=liv
spring.datasource.password=postgres
```

## 정리
postgreSQL을 이용해 데이터베이스를 조작하는 부분에 대해서 알아봤습니다. 그리고 동일한 기능을 스프링에서 데이터베이스를 연결해 호출하고 수행해보았습니다. 



참고자료: <br></br>[스프링프레임워크 첫걸음](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=301096602), 후루네스 키노시타 마사아키<br></br>https://www.postgresql.org/download/macosx/

